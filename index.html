<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Be My Valentine</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: radial-gradient(circle, #fff0f3 0%, #ffccd5 100%);
  font-family: 'Segoe UI', sans-serif;
  touch-action: none;
}

#ui-layer {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 10;
}

.interactive { pointer-events: auto; }

.glass-card {
  background: rgba(255,255,255,0.6);
  backdrop-filter: blur(8px);
  padding: 2rem;
  border-radius: 1.5rem;
  text-align: center;
  box-shadow: 0 8px 32px rgba(255,77,109,0.2);
  max-width: 90vw;
  transition: all 0.5s ease;
}

.btn-container {
  display: flex;
  gap: 2rem;
  margin-top: 2rem;
  justify-content: center;
  position: relative;
  height: 60px;
}

#no-btn {
  position: absolute;
  left: 60%;
  white-space: nowrap;
  /* Smooth transition for movement */
  transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

#yes-btn {
  position: absolute;
  left: 20%;
  white-space: nowrap;
}

@media (max-width: 640px) {
  #yes-btn { left: 10%; }
  #no-btn { left: 55%; }
}
</style>
</head>

<body>

<div id="ui-layer">
  <div class="glass-card" id="card">
    <h1 id="main-text" class="text-3xl md:text-5xl font-extrabold text-pink-600">
      Will you be my Valentine?
    </h1>

    <div class="btn-container" id="btn-parent">
      <button id="yes-btn"
        class="interactive bg-pink-500 hover:bg-pink-600 text-white text-xl font-bold px-10 py-4 rounded-full shadow-xl">
        Yes!
      </button>

      <button id="no-btn"
        class="interactive bg-white text-gray-500 text-lg font-bold px-8 py-3 rounded-full shadow-lg border">
        No
      </button>
    </div>
  </div>
</div>

<script>
let scene, camera, renderer, heart, photoMesh;
let isAccepted = false;
let flowerParticles = [];
let audioCtx;

// ---------- SOUNDS ----------
function initAudio() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function playRomanticSong() {
  const melody = [
    { f: 349.23, d: 0.6, t: 0 },   // F4
    { f: 440.00, d: 0.6, t: 0.6 }, // A4
    { f: 523.25, d: 1.2, t: 1.2 }, // C5
    { f: 493.88, d: 0.6, t: 2.4 }, // B4
    { f: 392.00, d: 1.8, t: 3.0 }, // G4
    { f: 440.00, d: 0.6, t: 4.8 }, // A4
    { f: 349.23, d: 1.2, t: 5.4 }  // F4
  ];

  const playNote = (freq, duration, startTime) => {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime + startTime);
    gain.gain.setValueAtTime(0, audioCtx.currentTime + startTime);
    gain.gain.linearRampToValueAtTime(0.15, audioCtx.currentTime + startTime + 0.1);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + startTime + duration);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start(audioCtx.currentTime + startTime);
    osc.stop(audioCtx.currentTime + startTime + duration);
  };

  const loopLength = 7;
  const playLoop = () => {
    if (!isAccepted) return;
    melody.forEach(n => playNote(n.f, n.d, n.t));
    setTimeout(playLoop, loopLength * 1000);
  };
  playLoop();
}

function playCelebrationChime() {
  const notes = [523.25, 659.25, 783.99, 1046.50];
  notes.forEach((freq, i) => {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.1);
    gain.gain.setValueAtTime(0.3, audioCtx.currentTime + i * 0.1);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.1 + 1.2);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start(audioCtx.currentTime + i * 0.1);
    osc.stop(audioCtx.currentTime + i * 0.1 + 1.5);
  });
}

// ---------- INIT ----------
function init3D() {
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.z = 5;

  renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  document.body.appendChild(renderer.domElement);

  scene.add(new THREE.AmbientLight(0xffffff, 1));
  const light = new THREE.PointLight(0xffffff, 1.2);
  light.position.set(5,5,5);
  scene.add(light);

  createHeart();
  createFlowers();
}

function createHeart() {
  const shape = new THREE.Shape();
  shape.moveTo(0.5,0.5);
  shape.bezierCurveTo(0.5,0.5,0.4,0,0,0);
  shape.bezierCurveTo(-0.6,0,-0.6,0.7,-0.6,0.7);
  shape.bezierCurveTo(-0.6,1.1,-0.3,1.5,0.5,1.9);
  shape.bezierCurveTo(1.3,1.5,1.6,1.1,1.6,0.7);
  shape.bezierCurveTo(1.6,0.7,1.6,0,1,0);
  shape.bezierCurveTo(0.7,0,0.5,0.5,0.5,0.5);

  const geo = new THREE.ExtrudeGeometry(shape,{
    depth:0.4,
    bevelEnabled:true,
    bevelSize:0.1,
    bevelThickness:0.1
  });
  geo.center();

  const mat = new THREE.MeshPhongMaterial({ color:0xff4d6d, shininess:120 });
  heart = new THREE.Mesh(geo, mat);
  heart.rotation.z = Math.PI;
  heart.scale.set(1.6,1.6,1.6);
  scene.add(heart);

  const loader = new THREE.TextureLoader();
  const texture = loader.load("ff8489ae-cca2-466f-bf29-7cab8dc18f17.png");
  const pGeo = new THREE.PlaneGeometry(1.3,1.8);
  const pMat = new THREE.MeshBasicMaterial({ map:texture, transparent:true, opacity:0, side:THREE.DoubleSide });
  photoMesh = new THREE.Mesh(pGeo, pMat);
  photoMesh.position.set(0, -0.1, 0.25);
  photoMesh.rotation.z = Math.PI;
  heart.add(photoMesh);
}

function createFlowers() {
  const c = document.createElement("canvas");
  c.width=64; c.height=64;
  const ctx=c.getContext("2d");
  ctx.font="48px serif";
  ctx.fillText("üå∏",6,50);
  const tex = new THREE.CanvasTexture(c);
  const mat = new THREE.SpriteMaterial({ map:tex });

  for(let i=0;i<40;i++){
    const s=new THREE.Sprite(mat);
    s.position.set((Math.random()-0.5)*15,Math.random()*15-5,(Math.random()-0.5)*15);
    s.scale.set(0.4,0.4,1);
    scene.add(s);
    flowerParticles.push(s);
  }
}

function animate(){
  requestAnimationFrame(animate);
  if(heart){
    heart.rotation.y += isAccepted ? 0.04 : 0.012;
    heart.position.y = Math.sin(Date.now()*0.002)*0.2;
  }
  if(isAccepted && photoMesh.material.opacity<1){
    photoMesh.material.opacity += 0.02;
  }
  flowerParticles.forEach(f=>{
    f.position.y -= isAccepted ? 0.1 : 0.02;
    if(f.position.y<-6) f.position.y=8;
  });
  renderer.render(scene,camera);
}

function setupUI(){
  const yes=document.getElementById("yes-btn");
  const no=document.getElementById("no-btn");
  const text=document.getElementById("main-text");
  const card=document.getElementById("card");

  yes.onclick=()=>{
    initAudio(); 
    isAccepted=true;
    
    playCelebrationChime();
    playRomanticSong();
    
    yes.style.display="none";
    no.style.display="none";
    card.style.background = "transparent";
    card.style.boxShadow = "none";
    card.style.backdropFilter = "none";
    card.style.border = "none";
    
    text.innerHTML="I Love You ‚ù§Ô∏è<br><span class='text-xl'>Forever & Always</span>";
    text.style.textShadow = "0 0 10px white";
    
    heart.material.color.setHex(0xff0033);
    const targetScale = window.innerWidth < 600 ? 2.8 : 3.5;
    heart.scale.set(targetScale, targetScale, targetScale);
    heart.position.set(0, 0, 0);
  };

  const moveNo = (e) => {
    if(isAccepted) return;
    const r = no.getBoundingClientRect();
    const mouseX = e.clientX || (e.touches ? e.touches[0].clientX : 0);
    const mouseY = e.clientY || (e.touches ? e.touches[0].clientY : 0);
    
    // Position of button center
    const btnCenterX = r.left + r.width / 2;
    const btnCenterY = r.top + r.height / 2;
    
    const distance = Math.hypot(mouseX - btnCenterX, mouseY - btnCenterY);
    
    // When the cursor is near the button
    if(distance < 110){
      const margin = 20; // Safety margin from screen edge
      
      // Calculate max bounds
      const maxX = window.innerWidth - r.width - margin;
      const maxY = window.innerHeight - r.height - margin;
      
      // Generate new random position strictly within visible area
      let newX = Math.random() * (maxX - margin) + margin;
      let newY = Math.random() * (maxY - margin) + margin;
      
      no.style.position = "fixed";
      no.style.left = newX + "px";
      no.style.top = newY + "px";
      no.style.margin = "0";
      no.style.zIndex = "100"; // Ensure it stays on top
    }
  };

  window.addEventListener("mousemove", moveNo);
  window.addEventListener("touchstart", moveNo, {passive: false});
  window.addEventListener("touchmove", moveNo, {passive: false});
}

window.onresize=()=>{
  if(camera && renderer) {
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  }
};

window.onload=()=>{
  init3D();
  setupUI();
  animate();
};
</script>

</body>
</html>
